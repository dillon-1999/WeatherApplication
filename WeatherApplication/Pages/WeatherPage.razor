@page "/weather"
@inject HttpClient Http

<h1>Welcome To The Weather Forecast!</h1>
<br />
<br />

<form id='weatherForm' @onclick:preventDefault="true">
    <label for="zip">Zip Code</label>
    <input type="text" @bind-value="zipcode" name="zip" id="zip" required />
    <input type="submit" @onclick="GetForecastAsync" value="Get Weather!" />
</form>

@if (f != null)
{
    <div>
        <h2>Weather For @f.Name</h2>
        <table class="table">
            <thead>
                <tr>
                    <th>Temperature</th>
                    <th>Feels Like</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>@f.main.Temp</td>
                    <td>@f.main.Feels_Like</td>
                </tr>
            </tbody>
        </table>
    </div>
    @if (f.weather.Length > 0)
    {
        <h1>Weather Specifics</h1>
        <table class="table">
            <thead>
                <tr>
                    <th>Type</th>
                    <th>Description</th>
                </tr>
            </thead>
            @foreach (Weather i in f.weather)
            {
                <tr>
                    <td>@i.Main</td>
                    <td>@i.Description</td>
                </tr>
            }
        </table>
    }
}

@code {
    public Forecast f;
    public string zipcode { get; set; }
    public string path = "https://api.openweathermap.org/data/2.5/weather?units=imperial&appid=0c9d70b001a131ec1b7798400723c28a&zip=";

    public async void GetForecastAsync()
    {
        try
        {
            f = await Http.GetFromJsonAsync<Forecast>(path + zipcode);
        }
        catch
        {
            Console.WriteLine("Error");
        }
    }

    // overall forecast container
    public class Forecast
    {
        public string Name { get; set; }
        public Main main { get; set; }
        public Weather[] weather { get; set; }
    }

    // container for the 'main' attribute
    public class Main
    {
        public decimal Temp { get; set; }
        public decimal Feels_Like { get; set; }
    }

    public class Weather
    {
        public string Main { get; set; }
        public string Description { get; set; }
    }
}
